# Aliaport – Parametreler Modülü Replit Görevi

## 0. Bağlam ve Kapsam

Bu görev, **Aliaport liman yönetim sistemi** için Replit üzerinde çalışan proje ZIP’ini kullanarak **Parametreler** modülünü hayata geçirmek içindir.

ZİP içeriği:
- Backend (FastAPI, SQLite)
- Frontend (React + Vite)
- `API_SQL_MAPPING.md`
- `schema.sql`

Bu görevde **kod tasarımı serbest**, ancak:
- Mevcut mimari *bozulmayacak*,
- Mevcut çalışan modüller (Cari, Motorbot, Sefer, Hizmet, Kurlar) kırılmayacak,
- Yeni işlevler **Parametreler modülü** altında toplanacaktır.

---

## 1. Genel Hedef

1. Backend tarafında **parametre yönetimi API’si** oluşturulacak.
2. Frontend tarafında **Parametreler** için yeni bir modül (component) yazılacak.
3. Parametreler modülü:
   - Birim listeleri (ör: ADET, GÜN, GRT)
   - KDV oranları (ör: %0, %10, %20)
   - Çeşitli sistem eşikleri (ör: “4 saat sonrası ikinci dilim”, “asgari sefer ücreti” vb.)
   gibi yapılandırma verilerini yönetecek.

Amaç:
- **Tarife/Hizmet modüllerinde kullanılacak** tüm sabit parametreler burada tutulacak.
- İleride başka modüller de bu parametreleri kullanabilecek.

---

## 2. Backend Görevi (FastAPI + SQLite)

### 2.1. Dosya Yapısı

Aşağıdaki yeni dosyaları oluştur:

- `app/models_parametre.py`
- `app/schemas_parametre.py`
- `app/router_parametre.py`

Ve `app/aliaport_web.py` içinde parametre router’ını register et.

### 2.2. Veritabanı Tasarımı

`schema.sql` ve `API_SQL_MAPPING.md` içeriğine **uyumlu** olacak şekilde aşağıdaki tabloyu oluştur:

#### 2.2.1. Ana Tablo: `Parametre`

Önerilen kolonlar (gerekirse genişletebilirsin, ama basit tut):

- `Id` (INTEGER, PK, AUTOINCREMENT)
- `Kategori` (TEXT, NOT NULL)  
  - Örnekler: `"BIRIM"`, `"KDV"`, `"ESIK"`, `"GENEL"`
- `Kod` (TEXT, NOT NULL)  
  - Örnekler:
    - Birim için: `ADET`, `GRT`, `SAAT`
    - KDV için: `KDV_0`, `KDV_10`, `KDV_20`
    - Eşik için: `MB_4_SAAT_DILIM`
- `Ad` (TEXT, NOT NULL)  
  - İnsan gözüne okunabilir isim
- `Deger` (TEXT, NULL)  
  - Sayısal veya metinsel değer, frontend gerektiği yerde parse edebilir
- `Aciklama` (TEXT, NULL)
- `AktifMi` (INTEGER(0/1), NOT NULL, default 1)
- `CreatedAt` (TEXT, ISO datetime, default CURRENT_TIMESTAMP)
- `UpdatedAt` (TEXT, nullable)

SQLite için:
- SQLAlchemy modelini `models_parametre.py` içinde tanımla.
- `Base` olarak mevcut projedeki ortak `Base`’i kullan (diğer modellerle aynı Base).

### 2.3. Pydantic Şemaları

`schemas_parametre.py` içinde:

- `ParametreBase`
- `ParametreCreate`
- `ParametreUpdate`
- `ParametreResponse`
- `PaginatedParametreResponse`

İsimlendirme, diğer modüllerde kullanılan şema stiline paralel olmalı.

### 2.4. API Endpoint’leri

`app/router_parametre.py` içinde, `APIRouter(prefix="/api/parametre", tags=["parametre"])` ile şu endpoint’leri yaz:

1. `GET /api/parametre/`
   - Query parametreleri:
     - `page: int = 1`
     - `page_size: int = 50`
     - `kategori: Optional[str] = None`
     - `aktif: Optional[bool] = None`
   - Dönüş:
     - `PaginatedParametreResponse` (items, total, page, page_size, total_pages)

2. `GET /api/parametre/{id}`
   - Tek kayıt döndür.

3. `POST /api/parametre/`
   - Tek parametre oluştur.
   - `ParametreCreate` al, `ParametreResponse` döndür.

4. `PUT /api/parametre/{id}`
   - Parametre güncelle.
   - `ParametreUpdate` al, `ParametreResponse` döndür.

5. `DELETE /api/parametre/{id}`
   - Soft delete değil, **gerçek silme** yap.
   - 204 veya simple `{success: true}` dönebilir.

6. `GET /api/parametre/by-kategori/{kategori}`
   - Belirli kategori altındaki tüm aktif parametreleri listele (`AktifMi = 1`).

### 2.5. Router Kayıt

`app/aliaport_web.py` içinde:

```python
from app.router_parametre import router as parametre_router

app.include_router(parametre_router)
```

Kayıt edilen endpoint ana yolu: `/api/parametre`

---

## 3. Frontend Görevi (React + Vite)

### 3.1. API Client

`src/lib/api/kurlar.ts` ve `src/lib/api/hizmet.ts` yapısına paralel olarak:

- Yeni dosya: `src/lib/api/parametre.ts`

Burada:

- Backend response (PascalCase) → Frontend (snake_case) için transformer yaz.
- Pagination response yapısı, kurlar/hizmet modülleriyle **aynı kontratı** kullanmalı.

Örnek mapping (backend → frontend):

- `Kategori` → `category`
- `Kod` → `code`
- `Ad` → `name`
- `Deger` → `value`
- `Aciklama` → `description`
- `AktifMi` → `is_active`
- `CreatedAt` → `created_at`
- `UpdatedAt` → `updated_at`

API fonksiyonları:
- `getAll(params)`
- `getById(id)`
- `create(payload)`
- `update(id, payload)`
- `remove(id)`
- `getByCategory(kategori)`

### 3.2. Parametreler Modülü Component’i

Yeni component dosyası:

- `src/components/modules/ParametreModule.tsx`

Özellikler:

1. Solda kategori seçimi (BIRIM / KDV / ESIK / GENEL)
2. Sağda seçili kategoriye ait parametre tablosu:
   - Kolonlar: KOD, AD, DEĞER, AÇIKLAMA, AKTİF
3. Yeni parametre ekleme formu (modal veya üst form)
4. Düzenleme:
   - Satır tıklanınca form alanlarına dolsun
   - Kaydet → `PUT /api/parametre/{id}`
5. Silme:
   - Satırdaki “Sil” butonu ile `DELETE` çağrısı

UI stili:
- Mevcut dashboard ve modül kartlarının stilini **bozmadan**, aynen takip et.
- Tailwind + mevcut component pattern’lerini kullan.

### 3.3. Nav / Menü Entegrasyonu

`src/App.tsx` içinde:

- `currentPage === "parametreler"` için `ParametreModule` render et.
- PlaceholderModule kontrolüne bu yeni modülü **EKLE** ki placeholder’a düşmesin.

---

## 4. Test Senaryoları

Backend ve frontend beraber çalışırken aşağıdaki senaryoları doğrula:

1. `BIRIM` kategorisinde en az 3 kayıt oluştur:
   - ADET
   - GRT
   - SAAT

2. `KDV` kategorisinde:
   - KDV_0 → 0
   - KDV_10 → 10
   - KDV_20 → 20

3. `ESIK` kategorisinde:
   - MB_4_SAAT_DILIM → 4
   - MB_MIN_SEFER_TUTAR → 2500

Her kayıt:
- UI’da listelenmeli
- Düzenleme kaydedilmeli
- Silme işlemi tabloda yansıtılmalı

---

## 5. Teslim Kriterleri (Done Definition)

Bu görevin **tamamlanmış** sayılması için:

1. `aliaport.db` içinde `Parametre` tablosu oluşmuş olmalı.
2. `/api/parametre/` endpoint’i pagination ile çalışıyor olmalı.
3. `/api/parametre/by-kategori/{kategori}` endpoint’i aktif kayıtları dönmeli.
4. `src/lib/api/parametre.ts` içinde tüm temel CRUD fonksiyonları çalışmalı.
5. `ParametreModule`:
   - En az 3 kategori için (BIRIM, KDV, ESIK) kayıt listeleyip yönetebilmeli.
6. `App.tsx` üzerinden Parametreler menüsüne girilebilmeli ve PlaceholderModule **görünmemeli**.

Görev tamamlandığında:
- `replit.md` içine **“Parametreler Modülü eklendi (backend + frontend)”** notunu ekle.
- Varsa kısa bir kullanım özeti yaz (nasıl kayıt eklenir, nereden açılır).

---

## 6. Notlar

- Mevcut çalışma alanı, projeyi **bozmadan** genişletmek için kullanılmalıdır.
- Var olan pattern’lere (kurlar, hizmet, cari, motorbot) **maksimum uyum** esastır.
- Gerekli yerlerde `API_SQL_MAPPING.md` ve `schema.sql` referans alınmalı; çelişki varsa **backend gerçeği** (schema + çalışan endpointler) esas alınır.